<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Video Clipper - Extract Best Moments from YouTube</title>
    <meta name="description"
        content="AI-powered tool to automatically extract the most engaging clips from YouTube videos">
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">VC</span>
                <h1>AI Video Clipper</h1>
            </div>
            <p class="tagline">Extract the most engaging moments from any YouTube video</p>
        </header>

        <!-- Main Form -->
        <main class="main-content">
            <div class="input-card">
                <form id="clipForm" onsubmit="processVideo(event)">
                    <div class="form-group">
                        <label for="youtubeUrl">
                            <span class="label-icon">URL</span>
                            YouTube URL
                        </label>
                        <input type="url" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=..." required
                            autocomplete="off">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="keyword">
                                <span class="label-icon">KW</span>
                                Theme / Keyword <span class="optional">(optional)</span>
                            </label>
                            <input type="text" id="keyword" placeholder="e.g., funny moments, tutorial, tips">
                        </div>

                        <div class="form-group">
                            <label for="numClips">
                                <span class="label-icon">#</span>
                                Number of Clips
                            </label>
                            <div class="range-container">
                                <input type="range" id="numClips" min="1" max="10" value="5"
                                    oninput="updateClipCount(this.value)">
                                <span id="clipCount" class="clip-count">5</span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary" id="processBtn">
                        <span class="btn-icon">-></span>
                        Extract Clips
                    </button>
                </form>
            </div>

            <!-- Processing Status -->
            <div id="processingStatus" class="processing-status hidden">
                <div class="loader"></div>
                <div class="status-text">
                    <h3>Processing your video...</h3>
                    <p id="statusMessage">Starting download...</p>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Error Display -->
            <div id="errorDisplay" class="error-display hidden">
                <span class="error-icon">!</span>
                <p id="errorMessage"></p>
                <button onclick="hideError()" class="btn-secondary">Try Again</button>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="results-section hidden">
                <div class="results-header">
                    <h2>Extracted Clips</h2>
                    <div class="results-meta">
                        <span id="clipCountResult"></span>
                        <span id="processingTime"></span>
                    </div>
                </div>

                <div class="results-actions">
                    <button onclick="downloadAll()" class="btn-download-all">
                        <span class="btn-icon">ZIP</span>
                        Download All (ZIP)
                    </button>
                </div>

                <div id="clipsGrid" class="clips-grid">
                    <!-- Clips will be injected here -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by AI - Built with FFmpeg & Whisper</p>
        </footer>
    </div>

    <script>
        let currentYoutubeId = null;

        function updateClipCount(value) {
            document.getElementById('clipCount').textContent = value;
        }

        function showProcessing() {
            document.getElementById('processingStatus').classList.remove('hidden');
            document.getElementById('errorDisplay').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('processBtn').disabled = true;
            document.getElementById('processBtn').innerHTML = '<span class="btn-icon">...</span> Processing...';
        }

        function hideProcessing() {
            document.getElementById('processingStatus').classList.add('hidden');
            document.getElementById('processBtn').disabled = false;
            document.getElementById('processBtn').innerHTML = '<span class="btn-icon">-></span> Extract Clips';
        }

        function showError(message) {
            hideProcessing();
            document.getElementById('errorDisplay').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function hideError() {
            document.getElementById('errorDisplay').classList.add('hidden');
        }

        function updateStatus(message, progress = 0) {
            document.getElementById('statusMessage').textContent = message;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        async function processVideo(event) {
            event.preventDefault();

            const url = document.getElementById('youtubeUrl').value.trim();
            const keyword = document.getElementById('keyword').value.trim();
            const numClips = parseInt(document.getElementById('numClips').value);

            if (!url) {
                showError('Please enter a YouTube URL');
                return;
            }

            showProcessing();
            updateStatus('Downloading video...', 10);

            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: url,
                        keyword: keyword,
                        num_clips: numClips
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Processing failed');
                }

                hideProcessing();
                displayResults(data);

            } catch (error) {
                showError(error.message);
            }
        }

        function displayResults(data) {
            currentYoutubeId = data.youtube_id;

            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('clipCountResult').textContent = `${data.total_clips} clips extracted`;
            document.getElementById('processingTime').textContent = `${data.processing_time}s`;

            const grid = document.getElementById('clipsGrid');
            grid.innerHTML = '';

            data.clips.forEach((clip, index) => {
                const clipCard = document.createElement('div');
                clipCard.className = 'clip-card';
                clipCard.innerHTML = `
                    <div class="clip-video-container">
                        <video 
                            controls 
                            preload="metadata"
                            poster=""
                        >
                            <source src="/clips/${data.youtube_id}/${clip.filename}" type="video/mp4">
                            Your browser does not support video playback.
                        </video>
                    </div>
                    <div class="clip-info">
                        <div class="clip-header">
                            <span class="clip-number">Clip ${index + 1}</span>
                            <span class="clip-duration">${formatDuration(clip.duration)}</span>
                        </div>
                        <h3 class="clip-title">${clip.title || 'Untitled Clip'}</h3>
                        <p class="clip-description">${clip.description}</p>
                        <div class="clip-timestamps">
                            <span>${formatDuration(clip.start)} - ${formatDuration(clip.end)}</span>
                        </div>
                        <button 
                            onclick="downloadClip('${data.youtube_id}', '${clip.filename}')" 
                            class="btn-download"
                        >
                            <span class="btn-icon">DL</span>
                            Download
                        </button>
                    </div>
                `;
                grid.appendChild(clipCard);
            });

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function downloadClip(youtubeId, filename) {
            window.location.href = `/download/${youtubeId}/${filename}`;
        }

        function downloadAll() {
            if (currentYoutubeId) {
                window.location.href = `/download_all/${currentYoutubeId}`;
            }
        }
    </script>
</body>

</html>